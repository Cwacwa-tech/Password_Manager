(()=>{"use strict";var e={799:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setBadgeText=function(e){const t=e?"ON":"OFF";chrome.action.setBadgeText({text:t})},t.simulateUserInput=function(e,t){var r;if(e.disabled||e.readOnly)return;const o=null===(r=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value"))||void 0===r?void 0:r.set;o?o.call(e,t):e.value=t,["input","change","keydown","keyup"].forEach((t=>{let r;r="keydown"===t||"keyup"===t?new KeyboardEvent(t,{bubbles:!0,cancelable:!0,key:"L"}):new Event(t,{bubbles:!0}),e.dispatchEvent(r)})),e.focus(),setTimeout((()=>{e.blur()}),100)}}},t={};function r(o){var s=t[o];if(void 0!==s)return s.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}(()=>{function e(e={}){const{autoRefresh:t=!1,retryCount:r=0,retryDelay:o=500}=e;let s=0;const n=()=>new Promise(((e,r)=>{chrome.storage.local.get(["authData"],(o=>{if(chrome.runtime.lastError)return console.error("Chrome runtime error:",chrome.runtime.lastError.message),void r(new Error(chrome.runtime.lastError.message));if(!o||"object"!=typeof o)return void r(new Error("Invalid storage data format"));const s=o.authData;s?s.token&&"string"==typeof s.token?s.expires&&"number"==typeof s.expires&&Date.now()>s.expires?t&&"string"==typeof s.refreshToken?(console.log("Token expired, attempting refresh"),r(new Error("Token expired - refresh not implemented"))):r(new Error("Authentication token has expired")):e(s.token):r(new Error("No valid authentication token found")):r(new Error("No authentication data found"))}))})).catch((e=>{if(s++,s<=r)return console.log(`Retry attempt ${s}/${r} after error: ${e.message}`),new Promise((e=>setTimeout(e,o))).then(n);throw e}));return n()}(0,r(799).setBadgeText)(!0),chrome.runtime.onMessage.addListener(((t,r,o)=>{if("generate_password"===t.action)return fetch("http://localhost:8000/password/generate",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{e.password?o({password:e.password}):o({error:"Failed to generate password"})})).catch((e=>{console.error("Error generating password:",e),o({error:"Failed to contact backend"})})),!0;if("login"===t.action){const e=new URLSearchParams;return e.append("username",t.email),e.append("password",t.masterPassword),fetch("http://localhost:8000/auth/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e.toString()}).then((e=>e.json())).then((e=>{if(e.access_token){const t=e.expires_in||3600;chrome.storage.local.set({authData:{token:e.access_token,expires:Date.now()+1e3*t,refreshToken:e.refresh_token||null}},(()=>{console.log("Token stored successfully.")})),o({success:!0,token:e.access_token})}else o({success:!1,error:e.detail||"Login failed"})})).catch((e=>{console.error("Login error:",e),o({success:!1,error:"Failed to contact backend"})})),!0}if("saveCredentials"===t.action){const r=t.data;return e().then((e=>fetch("http://localhost:8000/vault/passwords",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify(r)}))).then((e=>{if(!e.ok&&200!==e.status)throw new Error(`Server returned ${e.status}: ${e.statusText}`);return e.json()})).then((e=>{"Password already saved!"===e.message?o({success:!0,message:"Password already saved!"}):o({success:!0,message:"Credentials saved successfully"})})).catch((e=>{console.error("Error saving credentials:",e),o({success:!1,message:"Failed to save credentials"})})),!0}if("getCredentials"===t.action){const r=t.site;return e().then((e=>fetch(`http://localhost:8000/vault/passwords?site=${encodeURIComponent(r)}`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}))).then((e=>{if(!e.ok)throw new Error(`Server returned ${e.status}: ${e.statusText}`);return e.json()})).then((e=>{o({success:!0,credentials:e})})).catch((e=>{console.error("Error fetching credentials:",e),o({success:!1,error:e.message})})),!0}}))})()})();
//# sourceMappingURL=background.js.map